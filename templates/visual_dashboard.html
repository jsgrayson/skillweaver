<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visual Weaver Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body {
            background-color: #121212;
            color: #e0e0e0;
        }

        .card {
            background-color: #1e1e1e;
            border: 1px solid #333;
        }

        .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

        .btn-success {
            background-color: #198754;
            border-color: #198754;
        }

        .btn-danger {
            background-color: #dc3545;
            border-color: #dc3545;
        }

        .btn-warning {
            background-color: #ffc107;
            border-color: #ffc107;
            color: #000;
        }

        pre {
            background-color: #2d2d2d;
            color: #f8f8f2;
            padding: 10px;
            border-radius: 5px;
        }
    </style>
</head>

<body>
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container-fluid">
            <span class="navbar-brand mb-0 h1">üëÅÔ∏è Visual Weaver Dashboard</span>
            <span id="status-badge" class="badge bg-secondary">UNKNOWN</span>
        </div>
    </nav>

    <div class="container">
        <div class="row">
            <!-- Controls & Status -->
            <div class="col-md-4">
                <div class="card mb-4">
                    <div class="card-header">Controls</div>
                    <div class="card-body d-grid gap-2">
                        <button class="btn btn-success" onclick="control('start')"><i class="fas fa-play"></i>
                            Start</button>
                        <button class="btn btn-warning" onclick="control('pause')"><i class="fas fa-pause"></i>
                            Pause</button>
                        <button class="btn btn-primary" onclick="control('resume')"><i class="fas fa-play-circle"></i>
                            Resume</button>
                        <button class="btn btn-danger" onclick="control('stop')"><i class="fas fa-stop"></i>
                            Stop</button>
                    </div>
                </div>

                <div class="card mb-4">
                    <div class="card-header">Status</div>
                    <div class="card-body">
                        <ul class="list-group list-group-flush bg-dark">
                            <li class="list-group-item bg-transparent text-light">Running: <span
                                    id="status-running">False</span></li>
                            <li class="list-group-item bg-transparent text-light">Paused: <span
                                    id="status-paused">True</span></li>
                            <li class="list-group-item bg-transparent text-light">Healer Mode: <span
                                    id="status-healer">False</span></li>
                            <li class="list-group-item bg-transparent text-light">Pet Mode: <span
                                    id="status-pet">False</span></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Live Preview -->
            <div class="col-md-8">
                <div class="card mb-4">
                    <div class="card-header">Live Preview (0.5 FPS)</div>
                    <div class="card-body text-center">
                        <img src="/api/preview" class="img-fluid border border-secondary" alt="Live Preview">
                    </div>
                </div>
            </div>
        </div>

        <!-- Configuration -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <span>Configuration (visual_config.json)</span>
                        <button class="btn btn-sm btn-primary" onclick="saveConfig()">Save Config</button>
                    </div>
                    <div class="card-body">
                        <textarea id="config-editor" class="form-control font-monospace" rows="15"
                            style="background-color: #2d2d2d; color: #f8f8f2; border: none;"></textarea>
                    </div>
                </div>
                <a href="/queue">Leveling Queue</a>
                <a href="/upgrades">Upgrade Finder</a>
                <a href="/droptimizer">Droptimizer</a>
                <a href="/shopping_list">Shopping List</a>
                <a href="/junk">Junk Manager</a>
                <a href="/encounter">Encounter Info</a>
            </div>
        </div>

        <script>
            function updateStatus() {
                fetch('/api/status')
                    .then(res => res.json())
                    .then(data => {
                        document.getElementById('status-running').innerText = data.running;
                        document.getElementById('status-paused').innerText = data.paused;
                        document.getElementById('status-healer').innerText = data.healer_mode;
                        document.getElementById('status-pet').innerText = data.pet_mode;

                        const badge = document.getElementById('status-badge');
                        if (data.running && !data.paused) {
                            badge.className = 'badge bg-success';
                            badge.innerText = 'RUNNING';
                        } else if (data.running && data.paused) {
                            badge.className = 'badge bg-warning text-dark';
                            badge.innerText = 'PAUSED';
                        } else {
                            badge.className = 'badge bg-danger';
                            badge.innerText = 'STOPPED';
                        }
                    });
            }

            function control(action) {
                fetch('/api/control', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: action })
                }).then(() => updateStatus());
            }

            function loadConfig() {
                fetch('/api/config')
                    .then(res => res.json())
                    .then(data => {
                        document.getElementById('config-editor').value = JSON.stringify(data, null, 4);
                    });
            }

            function saveConfig() {
                try {
                    const config = JSON.parse(document.getElementById('config-editor').value);
                    fetch('/api/config', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(config)
                    }).then(res => res.json())
                        .then(data => {
                            if (data.success) alert('Configuration Saved!');
                        });
                } catch (e) {
                    alert('Invalid JSON!');
                }
            }

            // Init
            setInterval(updateStatus, 1000);
            updateStatus();
            loadConfig();
        </script>
</body>

</html>